{% extends "base.html" %}
{% block content %}

<h1 class="section-title">Gestion des cotisations</h1>
<p class="section-subtitle">Historique des paiements des membres.</p>

<a href="{{ url_for('dues_new') }}" class="btn-gold" style="margin-bottom:25px; display:inline-block;">
    ‚ûï Nouvelle cotisation
</a>

<div class="card">
    <table>
        <thead>
        <tr>
            <th>Membre</th>
            <th>Ann√©e</th>
            <th>Montant</th>
            <th>Pay√©e</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody>
        {% for d in dues %}
        <tr>
            <td>{{ d.member.last_name }} {{ d.member.first_name }}</td>
            <td>{{ d.year }}</td>
            <td>{{ '%.2f'|format(d.amount) }} Fcfa</td>
            <td>
                {% if d.paid %}
                    ‚úî Pay√©e
                {% else %}
                    ‚ùå Non pay√©e
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('dues_edit', due_id=d.id) }}" class="action-edit">‚úè Modifier</a>

                <button class="action-delete" data-url="{{ url_for('dues_delete', due_id=d.id) }}">
                    üóë Supprimer
                </button>
            </td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center">Aucune cotisation pour le moment.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
document.querySelectorAll(".action-delete").forEach(btn => {
    btn.addEventListener("click", function () {
        let url = this.getAttribute("data-url");
        Swal.fire({
            title: "Supprimer cette cotisation ?",
            text: "Cette action est irr√©versible.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#0a0f2e",
            cancelButtonColor: "#B83227",
            confirmButtonText: "Oui, supprimer",
            cancelButtonText: "Annuler"
        }).then((result) => {
            if (result.isConfirmed) {
                let form = document.createElement("form");
                form.method = "POST";
                form.action = url;
                document.body.appendChild(form);
                form.submit();
            }
        });
    });
});
</script>

{% endblock %}
